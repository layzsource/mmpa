import{G as z,B as M,C as P,b as d,P as b,A as v,c as A,L as C,d as B,S as k,M as x,e as I}from"./index-CGNIAB2g.js";console.log("ğŸ‘ï¸ bioacousticVisualizer.js loaded");class j{constructor(t,o){console.log("ğŸ‘ï¸ Initializing Bioacoustic Visualizer..."),this.scene=t,this.manifold=o,this.currentParticles=null,this.formField=null,this.homologyMarkers=[],this.trajectoryLines=[],this.settings={showCurrents:!0,showForms:!0,showHomology:!0,currentParticleSize:.08,currentParticleColor:65450,formFieldOpacity:.6,trajectoryWidth:2,homologyMarkerSize:.15},this.currentsGroup=new z,this.formsGroup=new z,this.homologyGroup=new z,this.currentsGroup.name="BioacousticCurrents",this.formsGroup.name="BioacousticForms",this.homologyGroup.name="BioacousticHomology",t.add(this.currentsGroup),t.add(this.formsGroup),t.add(this.homologyGroup),console.log("ğŸ‘ï¸ Bioacoustic Visualizer initialized")}visualizeCurrents(t){if(this.settings.showCurrents){this.clearTrajectories(),console.log(`ğŸ‘ï¸ Visualizing ${t.length} currents...`);for(const o of t)!o.points||o.points.length<2||(this.createCurrentTrail(o),this.createTrajectoryLine(o))}}createCurrentTrail(t){const o=t.points,s=Math.min(o.length*5,100),i=new M,n=new Float32Array(s*3),r=new Float32Array(s*3);for(let e=0;e<s;e++){const l=e/(s-1),m=Math.floor(l*(o.length-1)),f=Math.min(m+1,o.length-1),y=l*(o.length-1)-m,p=o[m],g=o[f],u=p.q+(g.q-p.q)*y,h=p.p+(g.p-p.p)*y,F=u*Math.PI,H=Math.PI/2+h*.5,T=F*2,G=this.manifold.manifoldToEuclidean(F,H,T);n[e*3]=G.x,n[e*3+1]=G.y,n[e*3+2]=G.z;const L=(h*h+u*u)/2,w=new P;w.setHSL(.3+L*.5,1,.6),r[e*3]=w.r,r[e*3+1]=w.g,r[e*3+2]=w.b}i.setAttribute("position",new d(n,3)),i.setAttribute("color",new d(r,3));const a=new b({size:this.settings.currentParticleSize,vertexColors:!0,transparent:!0,opacity:.8,blending:v,depthWrite:!1}),c=new A(i,a);this.currentsGroup.add(c)}createTrajectoryLine(t){const o=t.points,s=[];for(const a of o){const c=a.q*Math.PI,e=Math.PI/2+a.p*.5,l=c*2,m=this.manifold.manifoldToEuclidean(c,e,l);s.push(m)}const i=new M().setFromPoints(s),n=new C({color:this.settings.currentParticleColor,linewidth:this.settings.trajectoryWidth,transparent:!0,opacity:.4}),r=new B(i,n);this.currentsGroup.add(r),this.trajectoryLines.push(r)}visualizeForms(t){if(!this.settings.showForms||!t||t.length===0)return;console.log(`ğŸ‘ï¸ Visualizing ${t.length} 2-form frames...`),this.clearFormField();const o=t[t.length-1];if(!o||o.length===0)return;const s=Math.min(o.length,500),i=new M,n=new Float32Array(s*3),r=new Float32Array(s*3),a=new Float32Array(s);for(let e=0;e<s;e++){const l=o[e];if(!l)continue;const m=l.frequency||e;l.time;const f=m/s*2*Math.PI,y=Math.PI/2,p=f*2,g=this.manifold.manifoldToEuclidean(f,y,p);n[e*3]=g.x,n[e*3+1]=g.y,n[e*3+2]=g.z;const u=l.value||0,h=new P;u>0?h.setHSL(0,1,.5+Math.min(u,.5)):h.setHSL(.6,1,.5+Math.min(Math.abs(u),.5)),r[e*3]=h.r,r[e*3+1]=h.g,r[e*3+2]=h.b,a[e]=this.settings.currentParticleSize*(1+Math.abs(u)*2)}i.setAttribute("position",new d(n,3)),i.setAttribute("color",new d(r,3)),i.setAttribute("size",new d(a,1));const c=new b({size:this.settings.currentParticleSize*.5,vertexColors:!0,transparent:!0,opacity:this.settings.formFieldOpacity,blending:v,depthWrite:!1,sizeAttenuation:!0});this.formField=new A(i,c),this.formsGroup.add(this.formField)}visualizeHomology(t){if(!this.settings.showHomology||!t||t.length===0)return;console.log(`ğŸ‘ï¸ Visualizing ${t.length} homology features...`),this.clearHomologyMarkers();const o=t.slice(0,10);for(let s=0;s<o.length;s++){const i=o[s],n=i.birth*2*Math.PI,r=i.death*2*Math.PI;this.createHomologyMarker(n,65280,i.persistence),this.createHomologyMarker(r,16711680,i.persistence),this.createBirthDeathLine(n,r,i.persistence)}}createHomologyMarker(t,o,s){const i=Math.PI/2,n=t*2,r=this.manifold.manifoldToEuclidean(t,i,n),a=new k(this.settings.homologyMarkerSize,8,8),c=new x({color:o,transparent:!0,opacity:.8}),e=new I(a,c);e.position.copy(r);const l=.5+s*1.5;e.scale.setScalar(l),this.homologyGroup.add(e),this.homologyMarkers.push(e)}createBirthDeathLine(t,o,s){const i=Math.PI/2,n=this.manifold.manifoldToEuclidean(t,i,t*2),r=this.manifold.manifoldToEuclidean(o,i,o*2),a=new M().setFromPoints([n,r]),c=new C({color:16776960,transparent:!0,opacity:.3+s*.5,linewidth:2}),e=new B(a,c);this.homologyGroup.add(e)}updateFromAnalyzer(t){if(!t||!t.currentAnalysis)return;const o=t.currentAnalysis;t.homology&&t.homology.currents[1].length>0&&this.visualizeCurrents(t.homology.currents[1]),o.forms&&o.forms.twoForms&&this.visualizeForms(o.forms.twoForms),o.barcodes&&o.barcodes.length>0&&this.visualizeHomology(o.barcodes)}clearTrajectories(){for(;this.currentsGroup.children.length>0;){const t=this.currentsGroup.children[0];t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),this.currentsGroup.remove(t)}this.trajectoryLines=[]}clearFormField(){for(;this.formsGroup.children.length>0;){const t=this.formsGroup.children[0];t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),this.formsGroup.remove(t)}this.formField=null}clearHomologyMarkers(){for(;this.homologyGroup.children.length>0;){const t=this.homologyGroup.children[0];t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),this.homologyGroup.remove(t)}this.homologyMarkers=[]}clear(){this.clearTrajectories(),this.clearFormField(),this.clearHomologyMarkers(),console.log("ğŸ‘ï¸ Visualizations cleared")}setVisibility(t,o,s){this.settings.showCurrents=t,this.settings.showForms=o,this.settings.showHomology=s,this.currentsGroup.visible=t,this.formsGroup.visible=o,this.homologyGroup.visible=s}dispose(){this.clear(),this.scene.remove(this.currentsGroup),this.scene.remove(this.formsGroup),this.scene.remove(this.homologyGroup),console.log("ğŸ‘ï¸ Visualizer disposed")}}console.log("ğŸ‘ï¸ Bioacoustic Visualizer module ready");export{j as BioacousticVisualizer};
//# sourceMappingURL=bioacousticVisualizer-gbfF7ri2.js.map
