console.log("ðŸŽµ audioSynthesizer.js loaded");class y{constructor(e){console.log("ðŸŽµ Initializing Audio Synthesizer..."),this.audioContext=e,this.params={duration:2,baseFrequency:440,carrierType:"sine",modulationDepth:.3,attackTime:.1,releaseTime:.2},this.isPlaying=!1,this.currentSource=null,console.log("ðŸŽµ Audio Synthesizer initialized")}synthesizeFromSignature(e,s=1){if(console.log(`ðŸŽµ Synthesizing audio (freq shift: ${s.toFixed(2)}x)...`),!e||!e.forms)return console.error("ðŸŽµ Invalid signature data"),null;const t=this.audioContext.sampleRate,n=this.params.duration,o=Math.floor(t*n),r=this.audioContext.createBuffer(1,o,t),i=r.getChannelData(0),c=e.forms.twoForms||[],l=e.currents[1]||[];for(let a=0;a<o;a++){const h=a/t,u=h/n,g=this.getAmplitudeFromForms(c,u),f=this.getFrequencyFromCurrents(l,u),p=this.params.baseFrequency*s*(1+f),d=Math.sin(2*Math.PI*p*h),m=this.getEnvelope(u);i[a]=g*m*d*.3}return console.log(`ðŸŽµ Synthesized ${o} samples (${n}s)`),r}getAmplitudeFromForms(e,s){if(!e||e.length===0)return .5;const t=Math.floor(s*e.length),n=e[Math.min(t,e.length-1)];if(!n||n.length===0)return .5;let o=0;for(const i of n){const c=i.value||i||0;o+=Math.abs(c)}const r=o/n.length;return Math.min(1,Math.max(0,r*.5+.5))}getFrequencyFromCurrents(e,s){if(!e||e.length===0)return 0;const t=e[0];if(!t.points||t.points.length===0)return 0;const n=Math.floor(s*t.points.length),r=t.points[Math.min(n,t.points.length-1)].p||0;return Math.tanh(r)}getEnvelope(e){const s=this.params.attackTime/this.params.duration,t=this.params.releaseTime/this.params.duration,n=.8;return e<s?e/s*n:e>1-t?(1-e)/t*n:n}translateSpecies(e,s,t){console.log(`ðŸŽµ Translating ${e} â†’ ${s}...`);const n=t.getSpecies(e),o=t.getSpecies(s);if(!n||!o)return console.error("ðŸŽµ Species not found"),null;if(n.signatures.length===0)return console.error(`ðŸŽµ No signatures for ${e}`),null;const r=n.signatures[0],i=t.computeFrequencyShift(n,o);return console.log(`ðŸŽµ Frequency shift: ${i.toFixed(2)}x`),this.synthesizeFromSignature(r,i)}play(e,s){if(!e){console.error("ðŸŽµ No buffer to play");return}this.stop(),console.log("ðŸŽµ Playing synthesized audio...");const t=this.audioContext.createBufferSource();t.buffer=e;const n=this.audioContext.createGain();n.gain.value=.5,t.connect(n),n.connect(this.audioContext.destination),t.onended=()=>{console.log("ðŸŽµ Playback ended"),this.isPlaying=!1,this.currentSource=null,s&&s()},t.start(0),this.isPlaying=!0,this.currentSource=t}stop(){if(this.currentSource){try{this.currentSource.stop()}catch{}this.currentSource=null}this.isPlaying=!1}morphSpecies(e,s,t,n){console.log(`ðŸŽµ Morphing ${e} â†” ${s} (factor: ${t.toFixed(2)})...`);const o=n.getSpecies(e),r=n.getSpecies(s);if(!o||!r)return console.error("ðŸŽµ Species not found"),null;if(o.signatures.length===0||r.signatures.length===0)return console.error("ðŸŽµ Missing signatures"),null;const i=1,c=n.computeFrequencyShift(o,r),l=i+(c-i)*t,a=o.signatures[0];return this.synthesizeFromSignature(a,l)}updateParams(e){Object.assign(this.params,e),console.log("ðŸŽµ Parameters updated:",this.params)}getState(){return{isPlaying:this.isPlaying,params:{...this.params}}}dispose(){this.stop(),console.log("ðŸŽµ Synthesizer disposed")}}console.log("ðŸŽµ Audio Synthesizer module ready");export{y as AudioSynthesizer};
//# sourceMappingURL=audioSynthesizer-BtfusyN6.js.map
