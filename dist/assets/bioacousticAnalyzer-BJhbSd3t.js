console.log("üìê differentialForms.js loaded");class b{constructor(){console.log("üìê Initializing Differential Forms Computer..."),this.fftSize=2048,this.hopSize=512,this.sampleRate=44100,this.formDegree=2,this.zeroForms=[],this.oneForms=[],this.twoForms=[],this.frequencyBins=this.fftSize/2,this.timeFrames=0,console.log("üìê Differential Forms Computer initialized")}computeFormsFromSpectrogram(e,t){return console.log(`üìê Computing differential forms from spectrogram (${t} frames, ${this.frequencyBins} bins)`),this.timeFrames=t,this.zeroForms=[],this.oneForms=[],this.twoForms=[],this.computeZeroForms(e,t),this.computeOneForms(e,t),this.computeTwoForms(e,t),{zeroForms:this.zeroForms,oneForms:this.oneForms,twoForms:this.twoForms,metadata:{timeFrames:this.timeFrames,frequencyBins:this.frequencyBins,sampleRate:this.sampleRate}}}computeZeroForms(e,t){for(let s=0;s<t;s++){const r=[];for(let o=0;o<this.frequencyBins;o++){const n=s*this.frequencyBins+o,i=e[n]||0;r.push(i*i)}this.zeroForms.push(r)}console.log(`üìê Computed ${this.zeroForms.length} 0-forms (energy density)`)}computeOneForms(e,t){for(let s=1;s<t-1;s++){const r=[];for(let o=1;o<this.frequencyBins-1;o++){const n=s*this.frequencyBins+o;e[n];const i=e[n+1]||0,a=e[n-1]||0,c=(i-a)/2,l=e[(s+1)*this.frequencyBins+o]||0,u=e[(s-1)*this.frequencyBins+o]||0,f=(l-u)/2;r.push({q:c,p:f,frequency:o,time:s})}this.oneForms.push(r)}console.log(`üìê Computed ${this.oneForms.length} frames of 1-forms`)}computeTwoForms(e,t){var s,r;for(let o=1;o<this.oneForms.length-1;o++){const n=[];if(this.oneForms[o]){for(let i=1;i<this.oneForms[o].length-1;i++){const a=this.oneForms[o][i],c=this.oneForms[o][i+1]||a,l=this.oneForms[o][i-1]||a,u=((s=this.oneForms[o+1])==null?void 0:s[i])||a,f=((r=this.oneForms[o-1])==null?void 0:r[i])||a,h=(c.p-l.p)/2,y=(u.q-f.q)/2,m=h-y;n.push({value:m,frequency:a.frequency,time:a.time})}this.twoForms.push(n)}}console.log(`üìê Computed ${this.twoForms.length} frames of 2-forms`)}exteriorDerivative(e,t){return t===0?this.gradientOperator(e):t===1?this.curlOperator(e):(console.log("üìê d¬≤ = 0: exterior derivative of 2-form vanishes"),[])}gradientOperator(e){return console.log("üìê Computing gradient (d: Œ©‚Å∞ ‚Üí Œ©¬π)"),this.oneForms}curlOperator(e){return console.log("üìê Computing curl (d: Œ©¬π ‚Üí Œ©¬≤)"),this.twoForms}wedgeProduct(e,t){return e.q!==void 0&&t.q!==void 0?e.q*t.p-e.p*t.q:0}hodgeStar(e,t){return t===1?{q:e.p,p:-e.q,frequency:e.frequency,time:e.time}:t===2?e.value:e}pullback(e,t){if(console.log("üìê Computing pullback F*œâ"),!e||!t)return console.warn("üìê Invalid pullback inputs"),e;if(e.degree===0){const s=[];for(let r=0;r<this.timeFrames;r++){const o=[];for(let n=0;n<this.frequencyBins;n++){const i=t(r,n),a=Math.floor(i.t),c=Math.floor(i.f);a>=0&&a<this.zeroForms.length&&c>=0&&c<this.frequencyBins?o.push(this.zeroForms[a][c]):o.push(0)}s.push(o)}return{degree:0,data:s,type:"pullback"}}if(e.degree===1){const s=[];for(let o=1;o<this.timeFrames-1;o++){const n=[];for(let i=1;i<this.frequencyBins-1;i++){const a=t(o,i),c=t(o+1e-6,i),l=t(o,i+1e-6),u=(c.t-a.t)/1e-6,f=(l.t-a.t)/1e-6,h=(c.f-a.f)/1e-6,y=(l.f-a.f)/1e-6,m=Math.floor(a.t),p=Math.floor(a.f);let g=0,d=0;m>=0&&m<this.oneForms.length&&p>=0&&p<this.frequencyBins&&(m*this.frequencyBins+p,this.oneForms[m]&&this.oneForms[m][p]&&(g=this.oneForms[m][p].q||0,d=this.oneForms[m][p].p||0));const S=u*g+h*d,q=f*g+y*d;n.push({q:S,p:q,frequency:i,time:o})}s.push(n)}return{degree:1,data:s,type:"pullback"}}if(e.degree===2){const s=[];for(let o=1;o<this.timeFrames-1;o++){const n=[];for(let i=1;i<this.frequencyBins-1;i++){const a=t(o,i),c=t(o+1e-6,i),l=t(o,i+1e-6),u=(c.t-a.t)/1e-6,f=(l.t-a.t)/1e-6,h=(c.f-a.f)/1e-6,y=(l.f-a.f)/1e-6,m=u*y-f*h,p=Math.floor(a.t),g=Math.floor(a.f);let d=0;p>=0&&p<this.twoForms.length&&g>=0&&g<this.frequencyBins&&this.twoForms[p]&&this.twoForms[p][g]&&(d=this.twoForms[p][g]),n.push(m*d)}s.push(n)}return{degree:2,data:s,type:"pullback"}}return console.warn(`üìê Pullback not implemented for degree ${e.degree}`),e}getFormState(){return{zeroFormsCount:this.zeroForms.length,oneFormsCount:this.oneForms.length,twoFormsCount:this.twoForms.length,timeFrames:this.timeFrames,frequencyBins:this.frequencyBins}}}console.log("üìê Differential Forms module ready");console.log("üéµ spectrogramPipeline.js loaded");class w{constructor(e,t=2048){console.log("üéµ Initializing Spectrogram Pipeline..."),this.audioContext=e,this.fftSize=t,this.hopSize=t/4,this.analyser=e.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyser.smoothingTimeConstant=.3,this.frequencyData=new Float32Array(this.analyser.frequencyBinCount),this.timeDomainData=new Float32Array(this.analyser.fftSize),this.spectrogramMaxFrames=100,this.spectrogram=[],this.numMelBins=128,this.melFilterbank=this.createMelFilterbank(),this.frequencyToPosition=s=>Math.log(1+s/100),this.amplitudeToMomentum=s=>s,console.log(`üéµ Pipeline initialized: FFT size ${this.fftSize}, ${this.numMelBins} mel bins`)}createMelFilterbank(){const e=[],t=this.audioContext.sampleRate,s=this.analyser.frequencyBinCount,r=c=>2595*Math.log10(1+c/700),o=c=>700*(Math.pow(10,c/2595)-1),n=r(0),a=(r(t/2)-n)/(this.numMelBins+1);for(let c=0;c<this.numMelBins;c++){const l=new Float32Array(s),u=n+c*a,f=n+(c+1)*a,h=n+(c+2)*a,y=o(u),m=o(f),p=o(h);for(let g=0;g<s;g++){const d=g*t/(2*s);d>=y&&d<=m?l[g]=(d-y)/(m-y):d>m&&d<=p&&(l[g]=(p-d)/(p-m))}e.push(l)}return console.log(`üéµ Created ${this.numMelBins}-band mel filterbank`),e}connect(e){e.connect(this.analyser),console.log("üéµ Audio source connected to pipeline")}processFrame(){this.analyser.getFloatFrequencyData(this.frequencyData);const e=new Float32Array(this.frequencyData.length);for(let s=0;s<this.frequencyData.length;s++)e[s]=Math.pow(10,this.frequencyData[s]/20);const t=this.applyMelFilterbank(e);return this.spectrogram.push(t),this.spectrogram.length>this.spectrogramMaxFrames&&this.spectrogram.shift(),{melSpectrogram:t,frequencyData:e,timestamp:this.audioContext.currentTime}}applyMelFilterbank(e){const t=new Float32Array(this.numMelBins);for(let s=0;s<this.numMelBins;s++){let r=0;for(let o=0;o<e.length;o++)r+=e[o]*this.melFilterbank[s][o];t[s]=r}return t}getSpectrogramFlat(){const e=this.spectrogram.length,t=e*this.numMelBins,s=new Float32Array(t);for(let r=0;r<e;r++)for(let o=0;o<this.numMelBins;o++)s[r*this.numMelBins+o]=this.spectrogram[r][o];return{spectrogram:s,numFrames:e,numBins:this.numMelBins}}toPhaseSpace(){const e=[];for(let t=0;t<this.spectrogram.length;t++)for(let s=0;s<this.numMelBins;s++){const r=this.spectrogram[t][s];if(r>1e-6){const o=this.frequencyToPosition(s),n=this.amplitudeToMomentum(r),i=(n*n+o*o)/2;e.push({time:t,q:o,p:n,energy:i,frequency:s,amplitude:r})}}return e}extractFeatures(){if(this.spectrogram.length===0)return{bass:0,mid:0,treble:0,centroid:0,spread:0};const e=this.spectrogram[this.spectrogram.length-1],t=Math.floor(this.numMelBins*.25),s=Math.floor(this.numMelBins*.6);let r=0,o=0,n=0;for(let h=0;h<t;h++)r+=e[h];for(let h=t;h<s;h++)o+=e[h];for(let h=s;h<this.numMelBins;h++)n+=e[h];const i=r+o+n+1e-10;let a=0,c=0;for(let h=0;h<this.numMelBins;h++)a+=h*e[h],c+=e[h];const l=c>0?a/c/this.numMelBins:.5;let u=0;for(let h=0;h<this.numMelBins;h++){const y=h/this.numMelBins-l;u+=y*y*e[h]}const f=c>0?Math.sqrt(u/c):0;return{bass:r/i,mid:o/i,treble:n/i,centroid:l,spread:f}}clear(){this.spectrogram=[],this.frequencyData&&this.frequencyData.fill(0),this.timeDomainData&&this.timeDomainData.fill(0),console.log("üéµ Spectrogram buffer cleared and memory released")}getState(){return{fftSize:this.fftSize,numMelBins:this.numMelBins,spectrogramFrames:this.spectrogram.length,maxFrames:this.spectrogramMaxFrames,sampleRate:this.audioContext.sampleRate}}}console.log("üéµ Spectrogram Pipeline module ready");console.log("‚à´ homology.js loaded");class M{constructor(){console.log("‚à´ Initializing Homological Integrator..."),this.currents={0:[],1:[],2:[]},this.persistentBarcodes=[],this.birthDeathPairs=[],this.integrationCache=new Map,this.MAX_CACHE_SIZE=1e3,console.log("‚à´ Homological Integrator initialized")}createZeroCurrent(e,t,s=1){const r={degree:0,position:{q:e,p:t},weight:s,id:`0curr_${this.currents[0].length}`};return this.currents[0].push(r),r}createOneCurrent(e,t=1){const s={degree:1,points:e,weight:t,id:`1curr_${this.currents[1].length}`,length:this.computeCurveLength(e)};return this.currents[1].push(s),s}createTwoCurrent(e,t=1){const s={degree:2,triangles:e,weight:t,id:`2curr_${this.currents[2].length}`,area:this.computeSurfaceArea(e)};return this.currents[2].push(s),s}boundary(e){if(e.degree===0)return null;if(e.degree===1){const t=e.points,s=t[0];return{degree:0,components:[{position:t[t.length-1],weight:e.weight},{position:s,weight:-e.weight}]}}else if(e.degree===2)return{degree:1,components:this.extractBoundaryCurves(e.triangles).map(s=>({points:s,weight:e.weight}))};return null}integrate(e,t){const s=`${e.id}_${JSON.stringify(t)}`;if(this.integrationCache.has(s))return this.integrationCache.get(s);let r=0;if(e.degree===0&&t.degree===0)r=this.evaluateZeroForm(t,e.position)*e.weight;else if(e.degree===1&&t.degree===1){const o=e.points;for(let n=0;n<o.length-1;n++){const i=o[n],a=o[n+1],c={q:(i.q+a.q)/2,p:(i.p+a.p)/2},l={q:a.q-i.q,p:a.p-i.p},u=this.evaluateOneForm(t,c);r+=(u.q*l.q+u.p*l.p)*e.weight}}else if(e.degree===2&&t.degree===2)for(const o of e.triangles){const n=this.triangleCenter(o),i=this.triangleArea(o),a=this.evaluateTwoForm(t,n);r+=a*i*e.weight}else console.warn(`‚à´ Degree mismatch: current degree ${e.degree}, form degree ${t.degree}`);if(this.integrationCache.size>=this.MAX_CACHE_SIZE){const o=this.integrationCache.keys().next().value;this.integrationCache.delete(o)}return this.integrationCache.set(s,r),r}verifyStokes(e,t,s){const r=this.boundary(e);if(!r)return console.log("‚à´ Cannot verify Stokes: boundary is zero"),{verified:!1,reason:"boundary_zero"};const o=this.integrate(r,t),n=this.integrate(e,s),i=Math.abs(o-n),a=i<1e-6;return console.log(`‚à´ Stokes verification: ‚ü®‚àÇT, Œ±‚ü© = ${o.toFixed(6)}, ‚ü®T, dŒ±‚ü© = ${n.toFixed(6)}, error = ${i.toExponential(3)}`),{lhs:o,rhs:n,error:i,verified:a}}computePersistentHomology(e,t=2){console.log(`‚à´ Computing persistent homology for ${e.length} points...`);const s=50,r=t/s,o=[],n=new Map;for(let i=0;i<=s;i++){const a=i*r,c=this.buildAdjacency(e,a),l=this.findConnectedComponents(c);this.updatePersistence(n,l,a)}for(const[i,a]of n)a.death===1/0&&(a.death=t),a.death-a.birth>.01&&o.push({dimension:0,birth:a.birth,death:a.death,persistence:a.death-a.birth,id:i});return o.sort((i,a)=>a.persistence-i.persistence),this.persistentBarcodes=o,console.log(`‚à´ Found ${o.length} persistent features`),o}compareCurrents(e,t,s){if(e.degree!==t.degree)return console.warn("‚à´ Cannot compare currents of different degree"),0;let r=0,o=0;for(const n of s){if(n.degree!==e.degree)continue;const i=this.integrate(e,n),a=this.integrate(t,n),c=Math.max(Math.abs(i),Math.abs(a),1e-10),l=Math.abs(i-a)/c;r+=1-l,o+=1}return o>0?r/o:0}computeCurveLength(e){let t=0;for(let s=0;s<e.length-1;s++){const r=e[s+1].q-e[s].q,o=e[s+1].p-e[s].p;t+=Math.sqrt(r*r+o*o)}return t}computeSurfaceArea(e){let t=0;for(const s of e)t+=this.triangleArea(s);return t}triangleArea(e){const[t,s,r]=e;return .5*Math.abs(t.q*(s.p-r.p)+s.q*(r.p-t.p)+r.q*(t.p-s.p))}triangleCenter(e){const[t,s,r]=e;return{q:(t.q+s.q+r.q)/3,p:(t.p+s.p+r.p)/3}}evaluateZeroForm(e,t){return e[Math.floor(t.q)]||0}evaluateOneForm(e,t){return e.q!==void 0?e:{q:0,p:0}}evaluateTwoForm(e,t){return e.value||0}extractBoundaryCurves(e){const t=new Map;for(const r of e){const o=[[r[0],r[1]],[r[1],r[2]],[r[2],r[0]]];for(const n of o){const i=`${n[0].q},${n[0].p}_${n[1].q},${n[1].p}`;t.set(i,(t.get(i)||0)+1)}}const s=[];for(const[r,o]of t)if(o===1){const[n,i]=r.split("_").map(a=>{const[c,l]=a.split(",").map(Number);return{q:c,p:l}});s.push([n,i])}return s}buildAdjacency(e,t){const s=e.length,r=Array(s).fill(null).map(()=>[]);for(let o=0;o<s;o++)for(let n=o+1;n<s;n++)this.distance(e[o],e[n])<=t&&(r[o].push(n),r[n].push(o));return r}distance(e,t){const s=e.q-t.q,r=e.p-t.p;return Math.sqrt(s*s+r*r)}findConnectedComponents(e){const t=e.length,s=new Array(t).fill(!1),r=[];for(let o=0;o<t;o++)if(!s[o]){const n=[];this.dfs(o,e,s,n),r.push(n)}return r}dfs(e,t,s,r){s[e]=!0,r.push(e);for(const o of t[e])s[o]||this.dfs(o,t,s,r)}updatePersistence(e,t,s){for(const r of t){const o=r.sort().join(",");e.has(o)||e.set(o,{birth:s,death:1/0})}}getState(){return{currents:{0:this.currents[0].length,1:this.currents[1].length,2:this.currents[2].length},persistentBarcodes:this.persistentBarcodes.length,cacheSize:this.integrationCache.size}}clear(){this.currents={0:[],1:[],2:[]},this.persistentBarcodes=[],this.integrationCache.clear(),console.log("‚à´ Homology state cleared")}}console.log("‚à´ Homological Integration module ready");console.log("ü¶ú speciesLibrary.js loaded");class C{constructor(){console.log("ü¶ú Initializing Species Library..."),this.species=new Map,this.initializeDefaultSpecies(),console.log("ü¶ú Species Library initialized")}initializeDefaultSpecies(){this.addSpecies({id:"example_bird_1",name:"Example Songbird",scientificName:"Passeridae exemplaris",category:"bird",description:"Example bioacoustic signature for testing",frequencyRange:[2e3,8e3],typicalDuration:2.5}),this.addSpecies({id:"example_whale_1",name:"Example Whale",scientificName:"Cetacea exemplaris",category:"whale",description:"Example whale vocalization signature",frequencyRange:[20,500],typicalDuration:10}),console.log(`ü¶ú Loaded ${this.species.size} default species`)}addSpecies(e){const t={id:e.id||`species_${Date.now()}`,name:e.name||"Unknown Species",scientificName:e.scientificName||null,category:e.category||"unknown",description:e.description||"",frequencyRange:e.frequencyRange||[0,22050],typicalDuration:e.typicalDuration||5,signatures:[],stats:{numRecordings:0,avgFrequency:0,avgAmplitude:0,avgComplexity:0},dateAdded:new Date().toISOString(),tags:e.tags||[]};return this.species.set(t.id,t),console.log(`ü¶ú Added species: ${t.name} (${t.id})`),t.id}addSignature(e,t){const s=this.species.get(e);if(!s)return console.error(`ü¶ú Species not found: ${e}`),!1;const r={id:`sig_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),spectrogram:t.spectrogram||null,audioBuffer:t.audioBuffer||null,forms:{zeroForms:t.zeroForms||[],oneForms:t.oneForms||[],twoForms:t.twoForms||[]},currents:t.currents||{0:[],1:[],2:[]},homology:{barcodes:t.persistentBarcodes||[],bettiNumbers:t.bettiNumbers||[0,0,0]},phaseSpace:t.phaseSpace||[],features:t.features||{centroid:0,spread:0,bass:0,mid:0,treble:0},duration:t.duration||0,sampleRate:t.sampleRate||44100,notes:t.notes||""};return s.signatures.push(r),s.stats.numRecordings=s.signatures.length,this.updateSpeciesStats(e),console.log(`ü¶ú Added signature ${r.id} to ${s.name}`),!0}getSpecies(e){return this.species.get(e)||null}getSpeciesByCategory(e){const t=[];for(const s of this.species.values())s.category===e&&t.push(s);return t}searchSpecies(e){var r;const t=e.toLowerCase(),s=[];for(const o of this.species.values())(o.name.toLowerCase().includes(t)||(r=o.scientificName)!=null&&r.toLowerCase().includes(t)||o.description.toLowerCase().includes(t))&&s.push(o);return s}compareSpecies(e,t,s){const r=this.species.get(e),o=this.species.get(t);if(!r||!o)return console.error("ü¶ú One or both species not found"),null;if(r.signatures.length===0||o.signatures.length===0)return console.error("ü¶ú One or both species have no signatures"),null;console.log(`ü¶ú Comparing ${r.name} with ${o.name}...`);const n=r.signatures[0],i=o.signatures[0],a=this.compareForms(n.forms,i.forms,s),c=this.compareCurrents(n.currents,i.currents,s),l=this.compareHomology(n.homology,i.homology),u=.4*a+.4*c+.2*l,f={species1:{id:e,name:r.name},species2:{id:t,name:o.name},similarity:u,details:{forms:a,currents:c,homology:l},frequencyShift:this.computeFrequencyShift(r,o),timestamp:new Date().toISOString()};return console.log(`ü¶ú Similarity: ${(u*100).toFixed(1)}%`),f}compareForms(e,t,s){const r=this.computeFormMagnitude(e.twoForms),o=this.computeFormMagnitude(t.twoForms),n=Math.abs(r-o)/Math.max(r,o,1e-10);return Math.max(0,1-n)}compareCurrents(e,t,s){const r=e[1]||[],o=t[1]||[];if(r.length===0||o.length===0)return .5;const n=r.reduce((c,l)=>{var u;return c+(((u=l.points)==null?void 0:u.length)||0)},0)/r.length,i=o.reduce((c,l)=>{var u;return c+(((u=l.points)==null?void 0:u.length)||0)},0)/o.length,a=Math.abs(n-i)/Math.max(n,i,1e-10);return Math.max(0,1-a)}compareHomology(e,t){const s=e.barcodes||[],r=t.barcodes||[];if(s.length===0||r.length===0)return .5;const o=Math.abs(s.length-r.length),n=Math.max(s.length,r.length);return Math.max(0,1-o/n)}computeFormMagnitude(e){if(!e||e.length===0)return 0;let t=0;for(const s of e)if(Array.isArray(s))for(const r of s){const o=r.value||r||0;t+=o*o}return Math.sqrt(t)}computeFrequencyShift(e,t){const s=(e.frequencyRange[0]+e.frequencyRange[1])/2;return(t.frequencyRange[0]+t.frequencyRange[1])/2/s}updateSpeciesStats(e){const t=this.species.get(e);if(!t||t.signatures.length===0)return;const s=t.signatures,r=s.length;let o=0,n=0,i=0;for(const a of s)o+=a.features.centroid||0,n+=(a.features.bass+a.features.mid+a.features.treble)/3,i+=a.homology.barcodes.length||0;t.stats.avgFrequency=o/r,t.stats.avgAmplitude=n/r,t.stats.avgComplexity=i/r}exportSpecies(e){const t=this.species.get(e);return t?JSON.stringify(t,null,2):null}importSpecies(e){try{const t=JSON.parse(e);return this.species.set(t.id,t),console.log(`ü¶ú Imported species: ${t.name}`),t.id}catch(t){return console.error("ü¶ú Import failed:",t),null}}getStats(){let e=this.species.size,t=0;const s={};for(const r of this.species.values())t+=r.signatures.length,s[r.category]=(s[r.category]||0)+1;return{totalSpecies:e,totalSignatures:t,categoryCounts:s,avgSignaturesPerSpecies:e>0?t/e:0}}clear(){this.species.clear(),console.log("ü¶ú Species library cleared")}}console.log("ü¶ú Species Library module ready");console.log("üß¨ bioacousticAnalyzer.js loaded");class v{constructor(e){console.log("üß¨ Initializing Bioacoustic Analyzer..."),this.audioContext=e,this.spectrogram=new w(e),this.formsComputer=new b,this.homology=new M,this.library=new C,this.isAnalyzing=!1,this.analysisInterval=null,this.updateRate=100,this.currentAnalysis=null,console.log("üß¨ Bioacoustic Analyzer initialized")}connect(e){this.spectrogram.connect(e),console.log("üß¨ Audio source connected")}startAnalysis(){if(this.isAnalyzing){console.warn("üß¨ Analysis already running");return}console.log("üß¨ Starting bioacoustic analysis..."),this.isAnalyzing=!0,this.analysisInterval=setInterval(()=>{this.processFrame()},this.updateRate)}stopAnalysis(){this.isAnalyzing&&(console.log("üß¨ Stopping bioacoustic analysis..."),this.isAnalyzing=!1,this.analysisInterval&&(clearInterval(this.analysisInterval),this.analysisInterval=null))}processFrame(){if(this.spectrogram.processFrame(),this.spectrogram.spectrogram.length<10)return;const e=this.spectrogram.getSpectrogramFlat(),t=this.formsComputer.computeFormsFromSpectrogram(e.spectrogram,e.numFrames),s=this.spectrogram.toPhaseSpace();this.extractCurrents(s);const r=this.homology.computePersistentHomology(s,2),o=this.spectrogram.extractFeatures();this.currentAnalysis={timestamp:Date.now(),forms:t,phaseSpace:s,barcodes:r,features:o,currentCount:{0:this.homology.currents[0].length,1:this.homology.currents[1].length,2:this.homology.currents[2].length}}}extractCurrents(e){const t=new Map;for(const r of e)t.has(r.time)||t.set(r.time,[]),t.get(r.time).push(r);const s=Array.from(t.keys()).sort((r,o)=>r-o);for(let r=0;r<s.length-5;r+=5){const o=[];for(let n=0;n<5;n++){const i=t.get(s[r+n]);if(i&&i.length>0){const a=i.reduce((c,l)=>l.energy>c.energy?l:c);o.push({q:a.q,p:a.p})}}o.length>=3&&this.homology.createOneCurrent(o,1)}}captureSignature(e){if(!this.currentAnalysis)return console.error("üß¨ No analysis data to capture"),!1;console.log(`üß¨ Capturing signature for species: ${e}`);const t={spectrogram:this.spectrogram.getSpectrogramFlat(),zeroForms:this.currentAnalysis.forms.zeroForms,oneForms:this.currentAnalysis.forms.oneForms,twoForms:this.currentAnalysis.forms.twoForms,currents:{0:this.homology.currents[0],1:this.homology.currents[1],2:this.homology.currents[2]},persistentBarcodes:this.currentAnalysis.barcodes,phaseSpace:this.currentAnalysis.phaseSpace,features:this.currentAnalysis.features,duration:this.spectrogram.spectrogram.length*(this.spectrogram.hopSize/this.spectrogram.audioContext.sampleRate),sampleRate:this.spectrogram.audioContext.sampleRate,timestamp:new Date().toISOString()};return this.library.addSignature(e,t)}compareSpecies(e,t){return console.log(`üß¨ Comparing species: ${e} vs ${t}`),this.library.compareSpecies(e,t,this.homology)}verifyStokesTheorem(){var o;if(this.homology.currents[1].length===0)return console.warn("üß¨ No 1-currents available for Stokes verification"),null;if(!this.currentAnalysis||!this.currentAnalysis.forms.oneForms.length)return console.warn("üß¨ No differential forms available for Stokes verification"),null;const e=this.homology.currents[1][0],t=this.currentAnalysis.forms.oneForms[0][0],s=((o=this.currentAnalysis.forms.twoForms[0])==null?void 0:o[0])||{value:0},r=this.homology.verifyStokes(e,t,s);return console.log(`üß¨ Stokes verification: ${r.verified?"PASSED":"FAILED"}`),r}getState(){return{isAnalyzing:this.isAnalyzing,hasAnalysis:this.currentAnalysis!==null,spectrogram:this.spectrogram.getState(),forms:this.formsComputer.getFormState(),homology:this.homology.getState(),library:this.library.getStats()}}getAudioFeatures(){return this.spectrogram.extractFeatures()}clear(){this.stopAnalysis(),this.spectrogram.clear(),this.homology.clear(),this.currentAnalysis=null,console.log("üß¨ Analysis data cleared")}reset(){this.clear(),this.library.clear(),this.library.initializeDefaultSpecies(),console.log("üß¨ Analyzer reset to initial state")}}console.log("üß¨ Bioacoustic Analyzer module ready");export{v as BioacousticAnalyzer};
//# sourceMappingURL=bioacousticAnalyzer-BJhbSd3t.js.map
